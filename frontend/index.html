<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GameTrend Radar</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0a0f14;
      color: white;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .button {
      background: #007acc;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
    }

    .button:disabled {
      background: #666;
      cursor: not-allowed;
    }

    .error {
      background: #ff4444;
      color: white;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
    }

    .success {
      background: #44ff44;
      color: black;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: #1a2332;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      border: 2px solid;
    }

    .stat-value {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .stat-label {
      color: #aaa;
      font-size: 0.9rem;
    }

    .games-table {
      background: #1a2332;
      border-radius: 10px;
      overflow: hidden;
    }

    .games-header {
      padding: 20px;
      border-bottom: 1px solid #2a3a4a;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th,
    td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid #2a3a4a;
    }

    th {
      color: #aaa;
      font-weight: normal;
    }

    tr:hover {
      background: #1e2a3a;
    }

    .status-badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
    }

    .status-worth {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
      border: 1px solid #22c55e;
    }

    .status-observe {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
      border: 1px solid #ef4444;
    }

    .status-pending {
      background: rgba(234, 179, 8, 0.2);
      color: #eab308;
      border: 1px solid #eab308;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <!-- åŠ è½½Reactå’ŒReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <script>
    // å®Œæ•´çš„GameTrend Radaråº”ç”¨
    function App() {
      const [games, setGames] = React.useState([]);
      const [loading, setLoading] = React.useState(false);
      const [message, setMessage] = React.useState('é¡µé¢åŠ è½½ä¸­...');
      const [error, setError] = React.useState(null);

      // ä»åç«¯APIè·å–æ¸¸æˆæ•°æ®
      const fetchGames = async () => {
        try {
          const response = await fetch('/api/games');
          if (response.ok) {
            const data = await response.json();
            setGames(data);
            setMessage(`âœ… åŠ è½½äº† ${data.length} ä¸ªæ¸¸æˆ`);
          } else {
            setMessage('âŒ è·å–æ¸¸æˆæ•°æ®å¤±è´¥');
            setError(`HTTPé”™è¯¯: ${response.status}`);
          }
        } catch (err) {
          setMessage('âŒ è·å–æ¸¸æˆæ•°æ®å‡ºé”™');
          setError(err.message);
        }
      };

      // æ‰§è¡Œå®Œæ•´æ£€æµ‹
      const runFullCheck = async () => {
        setLoading(true);
        setError(null);
        setMessage('ğŸ”„ æ­£åœ¨æ‰§è¡Œå®Œæ•´æ£€æµ‹...');

        try {
          const response = await fetch('/api/daily-job', { method: 'POST' });
          if (response.ok) {
            setMessage('âœ… å®Œæ•´æ£€æµ‹æ‰§è¡ŒæˆåŠŸï¼æ­£åœ¨æ›´æ–°æ¸¸æˆæ•°æ®...');
            // æ£€æµ‹å®Œæˆåé‡æ–°è·å–æ¸¸æˆæ•°æ®
            setTimeout(fetchGames, 1000);
          } else {
            setMessage('âŒ å®Œæ•´æ£€æµ‹æ‰§è¡Œå¤±è´¥');
            setError(`HTTPé”™è¯¯: ${response.status}`);
          }
        } catch (err) {
          setMessage('âŒ å®Œæ•´æ£€æµ‹å‡ºé”™');
          setError(err.message);
        }

        setLoading(false);
      };

      // ç»„ä»¶åŠ è½½æ—¶è·å–æ¸¸æˆæ•°æ®
      React.useEffect(() => {
        fetchGames();
      }, []);

      // ç»Ÿè®¡æ•°æ®
      const stats = {
        total: games.length,
        worthDoing: games.filter(g => g.status === 'worth_doing').length,
        observe: games.filter(g => g.status === 'observe').length,
        pending: games.filter(g => g.status === 'pending').length
      };

      const getStatusClass = (status) => {
        switch (status) {
          case 'worth_doing': return 'status-worth';
          case 'observe': return 'status-observe';
          default: return 'status-pending';
        }
      };

      const getStatusText = (status) => {
        switch (status) {
          case 'worth_doing': return 'å€¼å¾—åš';
          case 'observe': return 'è§‚å¯Ÿ';
          default: return 'å¾…æ£€æµ‹';
        }
      };

      // æ¸²æŸ“å®Œæ•´çš„ç•Œé¢
      return React.createElement('div', {
        style: {
          minHeight: '100vh',
          background: '#0a0f14',
          color: 'white',
          padding: '20px'
        }
      }, [
        // å¤´éƒ¨
        React.createElement('div', {
          key: 'header',
          style: {
            textAlign: 'center',
            marginBottom: '30px',
            borderBottom: '1px solid #2a3a4a',
            paddingBottom: '20px'
          }
        }, [
          React.createElement('h1', {
            key: 'title',
            style: { fontSize: '2.5rem', marginBottom: '10px' }
          }, 'ğŸ® GameTrend Radar'),
          React.createElement('p', {
            key: 'subtitle',
            style: { color: '#aaa', fontSize: '1.1rem' }
          }, 'HTML5 æ¸¸æˆè¶‹åŠ¿æ£€æµ‹å·¥å…·')
        ]),

        // çŠ¶æ€ä¿¡æ¯
        error && React.createElement('div', {
          key: 'error',
          style: {
            background: '#ff4444',
            color: 'white',
            padding: '10px',
            borderRadius: '5px',
            marginBottom: '20px'
          }
        }, `é”™è¯¯ä¿¡æ¯: ${error}`),

        React.createElement('div', {
          key: 'message',
          style: {
            background: message.includes('âœ…') ? '#44ff44' : message.includes('âŒ') ? '#ff4444' : '#007acc',
            color: message.includes('âœ…') ? 'black' : 'white',
            padding: '10px',
            borderRadius: '5px',
            marginBottom: '20px',
            fontWeight: 'bold'
          }
        }, message),

        // æ“ä½œæŒ‰é’®
        React.createElement('div', {
          key: 'buttons',
          style: {
            display: 'flex',
            gap: '10px',
            justifyContent: 'center',
            marginBottom: '30px'
          }
        }, [
          React.createElement('button', {
            key: 'refresh',
            onClick: fetchGames,
            disabled: loading,
            style: {
              background: '#007acc',
              color: 'white',
              border: 'none',
              padding: '12px 24px',
              borderRadius: '5px',
              cursor: 'pointer',
              fontSize: '1rem'
            }
          }, 'åˆ·æ–°æ•°æ®'),

          React.createElement('button', {
            key: 'run-check',
            onClick: runFullCheck,
            disabled: loading,
            style: {
              background: '#28a745',
              color: 'white',
              border: 'none',
              padding: '12px 24px',
              borderRadius: '5px',
              cursor: 'pointer',
              fontSize: '1rem'
            }
          }, loading ? 'æ‰§è¡Œä¸­...' : 'æ‰§è¡Œå®Œæ•´æ£€æµ‹')
        ]),

        // ç»Ÿè®¡æ•°æ®
        React.createElement('div', {
          key: 'stats',
          className: 'stats-grid'
        }, [
          React.createElement('div', {
            key: 'total',
            className: 'stat-card',
            style: { borderColor: '#666' }
          }, [
            React.createElement('div', {
              key: 'total-value',
              className: 'stat-value',
              style: { color: 'white' }
            }, stats.total),
            React.createElement('div', {
              key: 'total-label',
              className: 'stat-label'
            }, 'æ€»æ¸¸æˆæ•°')
          ]),

          React.createElement('div', {
            key: 'worth-doing',
            className: 'stat-card',
            style: { borderColor: '#22c55e' }
          }, [
            React.createElement('div', {
              key: 'worth-doing-value',
              className: 'stat-value',
              style: { color: '#22c55e' }
            }, stats.worthDoing),
            React.createElement('div', {
              key: 'worth-doing-label',
              className: 'stat-label'
            }, 'å€¼å¾—åš')
          ]),

          React.createElement('div', {
            key: 'observe',
            className: 'stat-card',
            style: { borderColor: '#ef4444' }
          }, [
            React.createElement('div', {
              key: 'observe-value',
              className: 'stat-value',
              style: { color: '#ef4444' }
            }, stats.observe),
            React.createElement('div', {
              key: 'observe-label',
              className: 'stat-label'
            }, 'è§‚å¯Ÿ')
          ]),

          React.createElement('div', {
            key: 'pending',
            className: 'stat-card',
            style: { borderColor: '#eab308' }
          }, [
            React.createElement('div', {
              key: 'pending-value',
              className: 'stat-value',
              style: { color: '#eab308' }
            }, stats.pending),
            React.createElement('div', {
              key: 'pending-label',
              className: 'stat-label'
            }, 'å¾…æ£€æµ‹')
          ])
        ]),

        // æ¸¸æˆåˆ—è¡¨
        React.createElement('div', {
          key: 'games',
          className: 'games-table'
        }, [
          React.createElement('div', {
            key: 'games-header',
            className: 'games-header'
          }, React.createElement('h2', {
            style: { margin: 0 }
          }, `æ¸¸æˆåˆ—è¡¨ (${games.length})`)),

          React.createElement('div', {
            key: 'games-content',
            style: { overflowX: 'auto' }
          }, React.createElement('table', {}, [
            React.createElement('thead', { key: 'thead' }, React.createElement('tr', {}, [
              React.createElement('th', { key: 'name' }, 'æ¸¸æˆåç§°'),
              React.createElement('th', { key: 'source' }, 'æ¥æº'),
              React.createElement('th', { key: 'trend' }, 'è¶‹åŠ¿åˆ†'),
              React.createElement('th', { key: 'youtube' }, 'YOUTUBE'),
              React.createElement('th', { key: 'total' }, 'æ€»åˆ†'),
              React.createElement('th', { key: 'status' }, 'çŠ¶æ€')
            ])),

            React.createElement('tbody', { key: 'tbody' },
              games.length === 0 ?
                React.createElement('tr', { key: 'empty' }, React.createElement('td', {
                  colSpan: 6,
                  style: {
                    textAlign: 'center',
                    padding: '40px',
                    color: '#aaa'
                  }
                }, 'æš‚æ— æ¸¸æˆæ•°æ®ï¼Œè¯·ç‚¹å‡»"æ‰§è¡Œå®Œæ•´æ£€æµ‹"å¼€å§‹æŠ“å–')) :
                games.map((game, index) => React.createElement('tr', {
                  key: game.id || index
                }, [
                  React.createElement('td', { key: 'name' }, game.gameName || 'æœªçŸ¥'),
                  React.createElement('td', { key: 'source' }, game.source || 'æœªçŸ¥'),
                  React.createElement('td', { key: 'trend' }, game.trendScore || 0),
                  React.createElement('td', { key: 'youtube' }, game.ytScore || 0),
                  React.createElement('td', { key: 'total' }, game.totalScore || 0),
                  React.createElement('td', { key: 'status' },
                    React.createElement('span', {
                      className: getStatusClass(game.status)
                    }, getStatusText(game.status))
                  )
                ]))
            )
          ]))
        ])
      ]);
    }

    // æ¸²æŸ“ç»„ä»¶ï¼Œå¹¶æ·»åŠ é”™è¯¯å¤„ç†
    try {
      const root = document.getElementById('root');
      if (root) {
        ReactDOM.createRoot(root).render(React.createElement(App));
      } else {
        document.body.innerHTML = '<div style="color: red; padding: 20px;">é”™è¯¯: æ‰¾ä¸åˆ°æ ¹å…ƒç´  #root</div>';
      }
    } catch (error) {
      document.body.innerHTML = '<div style="color: red; padding: 20px;">Reactæ¸²æŸ“é”™è¯¯: ' + error.message + '</div>';
    }
  </script>
</body>

</html>