<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GameTrend Radar</title>
  <link rel="stylesheet" crossorigin href="/assets/index-BLbnT8GC.css">
</head>

<body>
  <div id="root"></div>

  <!-- ä½¿ç”¨CDNåŠ è½½Reactå’ŒReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // åˆ›å»ºReactç»„ä»¶
      function App() {
        const [games, setGames] = React.useState([]);
        const [tasks, setTasks] = React.useState([]);
        const [statusFilter, setStatusFilter] = React.useState('all');
        const [sortBy, setSortBy] = React.useState('totalScore');
        const [sortOrder, setSortOrder] = React.useState('desc');
        const [loading, setLoading] = React.useState(false);

        // ä»ŽåŽç«¯APIèŽ·å–æ¸¸æˆæ•°æ®
        const fetchGames = React.useCallback(async () => {
          try {
            const response = await fetch('/api/games');
            if (response.ok) {
              const data = await response.json();
              setGames(data);
              addTask('âœ… æ¸¸æˆæ•°æ®åŠ è½½æˆåŠŸ');
            } else {
              addTask('âŒ èŽ·å–æ¸¸æˆæ•°æ®å¤±è´¥');
            }
          } catch (error) {
            console.error('Error fetching games:', error);
            addTask('âŒ èŽ·å–æ¸¸æˆæ•°æ®å‡ºé”™: ' + error.message);
          }
        }, []);

        // æ‰§è¡Œå®Œæ•´æ£€æµ‹
        const runFullCheck = async () => {
          setLoading(true);
          addTask('ðŸ”„ å¼€å§‹å®Œæ•´æ£€æµ‹...');

          try {
            const response = await fetch('/api/daily-job', { method: 'POST' });
            if (response.ok) {
              addTask('âœ… å®Œæ•´æ£€æµ‹æ‰§è¡ŒæˆåŠŸ');
              fetchGames();
            } else {
              addTask('âŒ å®Œæ•´æ£€æµ‹æ‰§è¡Œå¤±è´¥');
            }
          } catch (error) {
            console.error('Error running daily job:', error);
            addTask('âŒ å®Œæ•´æ£€æµ‹å‡ºé”™: ' + error.message);
          }

          setLoading(false);
        };

        // æ·»åŠ æ“ä½œæ—¥å¿—
        const addTask = (task) => {
          const timestamp = new Date().toLocaleString();
          setTasks(prev => [`${timestamp} - ${task}`, ...prev].slice(0, 10));
        };

        // åˆå§‹åŒ–åŠ è½½
        React.useEffect(() => {
          fetchGames();
        }, [fetchGames]);

        // è¿‡æ»¤å’ŒæŽ’åºæ¸¸æˆ
        const filteredGames = React.useMemo(() => {
          let result = [...games];

          // è¿‡æ»¤
          if (statusFilter !== 'all') {
            result = result.filter(game => game.status === statusFilter);
          }

          // æŽ’åº
          result.sort((a, b) => {
            const aVal = a[sortBy] || 0;
            const bVal = b[sortBy] || 0;
            return sortOrder === 'desc' ? bVal - aVal : aVal - bVal;
          });

          return result;
        }, [games, statusFilter, sortBy, sortOrder]);

        // ç»Ÿè®¡æ•°æ®
        const stats = React.useMemo(() => {
          return {
            total: games.length,
            worthDoing: games.filter(g => g.status === 'worth_doing').length,
            observe: games.filter(g => g.status === 'observe').length,
            pending: games.filter(g => g.status === 'pending').length
          };
        }, [games]);

        // èŽ·å–çŠ¶æ€æ ·å¼
        const getStatusStyle = (status) => {
          switch (status) {
            case 'worth_doing':
              return 'px-2 py-1 rounded text-xs bg-green-900/30 text-green-400 border border-green-700';
            case 'observe':
              return 'px-2 py-1 rounded text-xs bg-red-900/30 text-red-400 border border-red-700';
            default:
              return 'px-2 py-1 rounded text-xs bg-yellow-900/30 text-yellow-400 border border-yellow-700';
          }
        };

        // èŽ·å–çŠ¶æ€æ˜¾ç¤ºæ–‡æœ¬
        const getStatusText = (status) => {
          switch (status) {
            case 'worth_doing':
              return 'å€¼å¾—åš';
            case 'observe':
              return 'è§‚å¯Ÿ';
            default:
              return 'å¾…æ£€æµ‹';
          }
        };

        return React.createElement('div', {
          className: 'min-h-screen bg-[#0f1419] text-white'
        }, [
          React.createElement('header', {
            key: 'header',
            className: 'border-b border-gray-800 px-6 py-4'
          }, React.createElement('div', {
            className: 'flex items-center justify-between'
          }, [
            React.createElement('div', {
              key: 'header-title'
            }, [
              React.createElement('h1', {
                key: 'title',
                className: 'text-2xl flex items-center gap-2'
              }, 'ðŸŽ® GameTrend Radar'),
              React.createElement('p', {
                key: 'subtitle',
                className: 'text-sm text-gray-400 mt-1'
              }, 'HTML5 æ¸¸æˆè¶‹åŠ¿æ£€æµ‹å·¥å…·')
            ]),
            React.createElement('button', {
              key: 'run-button',
              onClick: runFullCheck,
              disabled: loading,
              className: 'bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white px-6 py-2 rounded-lg flex items-center gap-2 transition-colors'
            }, loading ? 'æ‰§è¡Œä¸­...' : 'æ‰§è¡Œå®Œæ•´æ£€æµ‹')
          ])),
          React.createElement('main', {
            key: 'main',
            className: 'p-6 space-y-6'
          }, [
            React.createElement('div', {
              key: 'stats',
              className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4'
            }, [
              React.createElement('div', {
                key: 'total',
                className: 'bg-[#1a2332] rounded-lg border-2 border-gray-700 p-6 text-center'
              }, [
                React.createElement('div', {
                  key: 'total-value',
                  className: 'text-5xl font-bold mb-2 text-white'
                }, stats.total),
                React.createElement('div', {
                  key: 'total-label',
                  className: 'text-sm text-gray-400'
                }, 'æ€»æ¸¸æˆæ•°')
              ]),
              React.createElement('div', {
                key: 'worth-doing',
                className: 'bg-[#1a2332] rounded-lg border-2 border-green-600 p-6 text-center'
              }, [
                React.createElement('div', {
                  key: 'worth-doing-value',
                  className: 'text-5xl font-bold mb-2 text-green-500'
                }, stats.worthDoing),
                React.createElement('div', {
                  key: 'worth-doing-label',
                  className: 'text-sm text-gray-400'
                }, 'å€¼å¾—åš')
              ]),
              React.createElement('div', {
                key: 'observe',
                className: 'bg-[#1a2332] rounded-lg border-2 border-red-600 p-6 text-center'
              }, [
                React.createElement('div', {
                  key: 'observe-value',
                  className: 'text-5xl font-bold mb-2 text-red-500'
                }, stats.observe),
                React.createElement('div', {
                  key: 'observe-label',
                  className: 'text-sm text-gray-400'
                }, 'è§‚å¯Ÿ')
              ]),
              React.createElement('div', {
                key: 'pending',
                className: 'bg-[#1a2332] rounded-lg border-2 border-yellow-600 p-6 text-center'
              }, [
                React.createElement('div', {
                  key: 'pending-value',
                  className: 'text-5xl font-bold mb-2 text-yellow-500'
                }, stats.pending),
                React.createElement('div', {
                  key: 'pending-label',
                  className: 'text-sm text-gray-400'
                }, 'å¾…æ£€æµ‹')
              ])
            ]),
            React.createElement('div', {
              key: 'actions',
              className: 'bg-[#1a2332] rounded-lg border border-gray-800 p-6'
            }, [
              React.createElement('h2', {
                key: 'actions-title',
                className: 'text-lg mb-4'
              }, 'å¿«é€Ÿæ“ä½œ'),
              React.createElement('div', {
                key: 'action-buttons',
                className: 'flex flex-wrap gap-3'
              }, [
                React.createElement('button', {
                  key: 'scrape',
                  className: 'bg-[#0f1419] hover:bg-[#1f2937] border border-gray-700 hover:border-gray-600 px-4 py-2 rounded text-sm transition-colors flex items-center gap-2'
                }, 'ðŸŽ® æŠ“å–æ¸¸æˆ'),
                React.createElement('button', {
                  key: 'trend',
                  className: 'bg-[#0f1419] hover:bg-[#1f2937] border border-gray-700 hover:border-gray-600 px-4 py-2 rounded text-sm transition-colors flex items-center gap-2'
                }, 'ðŸ“ˆ è¶‹åŠ¿æ£€æµ‹'),
                React.createElement('button', {
                  key: 'youtube',
                  className: 'bg-[#0f1419] hover:bg-[#1f2937] border border-gray-700 hover:border-gray-600 px-4 py-2 rounded text-sm transition-colors flex items-center gap-2'
                }, 'ðŸ“º YouTubeæ£€æµ‹'),
                React.createElement('button', {
                  key: 'update',
                  className: 'bg-[#0f1419] hover:bg-[#1f2937] border border-gray-700 hover:border-gray-600 px-4 py-2 rounded text-sm transition-colors flex items-center gap-2'
                }, 'ðŸ”„ æ›´æ–°è¯„åˆ†')
              ])
            ]),
            React.createElement('div', {
              key: 'filters',
              className: 'bg-[#1a2332] rounded-lg border border-gray-800 p-6'
            }, React.createElement('div', {
              className: 'flex flex-wrap items-center gap-4'
            }, [
              React.createElement('div', {
                key: 'status-filter',
                className: 'flex items-center gap-2'
              }, [
                React.createElement('label', {
                  key: 'status-label',
                  className: 'text-sm text-gray-400'
                }, 'çŠ¶æ€ç­›é€‰:'),
                React.createElement('select', {
                  key: 'status-select',
                  value: statusFilter,
                  onChange: (e) => setStatusFilter(e.target.value),
                  className: 'bg-[#0f1419] border border-gray-700 rounded px-3 py-1.5 text-sm focus:outline-none focus:border-blue-500'
                }, [
                  React.createElement('option', {
                    key: 'all',
                    value: 'all'
                  }, 'å…¨éƒ¨'),
                  React.createElement('option', {
                    key: 'worth-doing',
                    value: 'worth_doing'
                  }, 'å€¼å¾—åš'),
                  React.createElement('option', {
                    key: 'observe',
                    value: 'observe'
                  }, 'è§‚å¯Ÿ'),
                  React.createElement('option', {
                    key: 'pending',
                    value: 'pending'
                  }, 'å¾…æ£€æµ‹')
                ])
              ]),
              React.createElement('div', {
                key: 'sort-filter',
                className: 'flex items-center gap-2'
              }, [
                React.createElement('label', {
                  key: 'sort-label',
                  className: 'text-sm text-gray-400'
                }, 'æŽ’åº:'),
                React.createElement('select', {
                  key: 'sort-select',
                  value: sortBy,
                  onChange: (e) => setSortBy(e.target.value),
                  className: 'bg-[#0f1419] border border-gray-700 rounded px-3 py-1.5 text-sm focus:outline-none focus:border-blue-500'
                }, [
                  React.createElement('option', {
                    key: 'total',
                    value: 'totalScore'
                  }, 'æ€»åˆ†'),
                  React.createElement('option', {
                    key: 'trend',
                    value: 'trendScore'
                  }, 'è¶‹åŠ¿åˆ†'),
                  React.createElement('option', {
                    key: 'youtube',
                    value: 'ytScore'
                  }, 'YouTubeåˆ†')
                ])
              ]),
              React.createElement('div', {
                key: 'order-filter',
                className: 'flex items-center gap-2'
              }, [
                React.createElement('select', {
                  key: 'order-select',
                  value: sortOrder,
                  onChange: (e) => setSortOrder(e.target.value),
                  className: 'bg-[#0f1419] border border-gray-700 rounded px-3 py-1.5 text-sm focus:outline-none focus:border-blue-500'
                }, [
                  React.createElement('option', {
                    key: 'desc',
                    value: 'desc'
                  }, 'é™åº'),
                  React.createElement('option', {
                    key: 'asc',
                    value: 'asc'
                  }, 'å‡åº')
                ])
              ])
            ])),
            React.createElement('div', {
              key: 'games',
              className: 'bg-[#1a2332] rounded-lg border border-gray-800 overflow-hidden'
            }, [
              React.createElement('div', {
                key: 'games-header',
                className: 'p-6 pb-4'
              }, React.createElement('h2', {
                className: 'text-lg'
              }, ['æ¸¸æˆåˆ—è¡¨ (', filteredGames.length, ')'])),
              React.createElement('div', {
                key: 'games-table',
                className: 'overflow-x-auto'
              }, React.createElement('table', {
                className: 'w-full'
              }, [
                React.createElement('thead', {
                  key: 'thead'
                }, React.createElement('tr', {
                  className: 'border-t border-b border-gray-800'
                }, [
                  React.createElement('th', {
                    key: 'name',
                    className: 'text-left px-6 py-3 text-sm text-gray-400 font-normal'
                  }, 'æ¸¸æˆåç§°'),
                  React.createElement('th', {
                    key: 'source',
                    className: 'text-left px-6 py-3 text-sm text-gray-400 font-normal'
                  }, 'æ¥æº'),
                  React.createElement('th', {
                    key: 'trend',
                    className: 'text-left px-6 py-3 text-sm text-gray-400 font-normal'
                  }, 'è¶‹åŠ¿åˆ†'),
                  React.createElement('th', {
                    key: 'youtube',
                    className: 'text-left px-6 py-3 text-sm text-gray-400 font-normal'
                  }, 'YOUTUBE'),
                  React.createElement('th', {
                    key: 'total',
                    className: 'text-left px-6 py-3 text-sm text-gray-400 font-normal'
                  }, 'æ€»åˆ†'),
                  React.createElement('th', {
                    key: 'status',
                    className: 'text-left px-6 py-3 text-sm text-gray-400 font-normal'
                  }, 'çŠ¶æ€'),
                  React.createElement('th', {
                    key: 'details',
                    className: 'text-left px-6 py-3 text-sm text-gray-400 font-normal'
                  }, 'è¯¦æƒ…')
                ])),
                React.createElement('tbody', {
                  key: 'tbody'
                }, filteredGames.length === 0 ? React.createElement('tr', {
                  key: 'empty'
                }, React.createElement('td', {
                  colSpan: 7,
                  className: 'text-center py-12 text-gray-500'
                }, 'æš‚æ— æ¸¸æˆæ•°æ®ï¼Œè¯·ç‚¹å‡»"æ‰§è¡Œå®Œæ•´æ£€æµ‹"å¼€å§‹æŠ“å–')) : filteredGames.map((game, index) => React.createElement('tr', {
                  key: game.id,
                  className: 'border-b border-gray-800 hover:bg-[#0f1419] transition-colors'
                }, [
                  React.createElement('td', {
                    key: 'name-' + game.id,
                    className: 'px-6 py-4'
                  }, game.gameName),
                  React.createElement('td', {
                    key: 'source-' + game.id,
                    className: 'px-6 py-4 text-gray-400'
                  }, game.source),
                  React.createElement('td', {
                    key: 'trend-' + game.id,
                    className: 'px-6 py-4'
                  }, game.trendScore),
                  React.createElement('td', {
                    key: 'youtube-' + game.id,
                    className: 'px-6 py-4'
                  }, game.ytScore),
                  React.createElement('td', {
                    key: 'total-' + game.id,
                    className: 'px-6 py-4'
                  }, game.totalScore),
                  React.createElement('td', {
                    key: 'status-' + game.id,
                    className: 'px-6 py-4'
                  }, React.createElement('span', {
                    className: getStatusStyle(game.status)
                  }, getStatusText(game.status))),
                  React.createElement('td', {
                    key: 'details-' + game.id,
                    className: 'px-6 py-4'
                  }, React.createElement('button', {
                    className: 'text-blue-500 hover:text-blue-400 text-sm'
                  }, 'æŸ¥çœ‹'))
                ])))
              ]))
            ]),
            React.createElement('div', {
              key: 'tasks',
              className: 'bg-[#1a2332] rounded-lg border border-gray-800 p-6'
            }, [
              React.createElement('h2', {
                key: 'tasks-title',
                className: 'text-lg mb-4'
              }, 'æœ€è¿‘æ“ä½œæ—¥å¿—'),
              tasks.length === 0 ? React.createElement('div', {
                key: 'empty-tasks',
                className: 'text-center py-12 text-gray-500'
              }, 'æš‚æ— æ“ä½œæ—¥å¿—') : React.createElement('div', {
                key: 'task-list',
                className: 'space-y-2'
              }, tasks.map((task, index) => React.createElement('div', {
                key: index,
                className: 'text-sm text-gray-400 border-b border-gray-800 pb-2 last:border-0'
              }, task))))
          ])
        ]);
      }

      // æ¸²æŸ“ç»„ä»¶
      const root = document.getElementById('root');
      if (root) {
        ReactDOM.createRoot(root).render(React.createElement(App));
      }
    });
  </script>
</body>

</html>